<div class="wash-request-container">
  <h2 class="title">Request a Car Wash</h2>

  <!-- Car Add Form (Always visible) -->
  <div class="car-form">
    <h4>Add Your Car</h4>
    <form [formGroup]="carForm" (ngSubmit)="onCarSubmit()">
      <div>
        <label for="brand">Brand</label>
        <input
          type="text"
          id="brand"
          formControlName="brand"
          placeholder="Enter car brand"
        />
        <small *ngIf="carForm.get('brand')?.touched && carForm.get('brand')?.invalid">Brand is required</small>
      </div>

      <div>
        <label for="model">Model</label>
        <input
          type="text"
          id="model"
          formControlName="model"
          placeholder="Enter car model"
        />
        <small *ngIf="carForm.get('model')?.touched && carForm.get('model')?.invalid">Model is required</small>
      </div>

      <div>
        <label for="year">Year</label>
        <input
          type="number"
          id="year"
          formControlName="year"
          placeholder="Enter car year"
        />
        <small *ngIf="carForm.get('year')?.touched && carForm.get('year')?.invalid">Year is required</small>
      </div>

      <div>
        <label for="color">Color</label>
        <input
          type="text"
          id="color"
          formControlName="color"
          placeholder="Enter car color"
        />
        <small *ngIf="carForm.get('color')?.touched && carForm.get('color')?.invalid">Color is required</small>
      </div>

      <div>
        <label for="licensePlate">License Plate</label>
        <input
          type="text"
          id="licensePlate"
          formControlName="licensePlate"
          placeholder="Enter license plate"
        />
        <small *ngIf="carForm.get('licensePlate')?.touched && carForm.get('licensePlate')?.invalid">License plate is required</small>
      </div>

      <div class="button-container">
        <button type="submit" [disabled]="carForm.invalid">Add Car</button>
        <button type="button" (click)="skipCarForm()">Skip</button>
      </div>
    </form>
  </div>

  <!-- Wash Request Form (Visible after adding a car or skipping) -->
  <form *ngIf="carAdded" [formGroup]="washRequestForm" (ngSubmit)="onSubmit()">
    <div>
      <label for="carId">Select Car</label>
      <select id="carId" formControlName="carId">
        <option value="" disabled selected>Choose your car</option>
        <option *ngFor="let car of userCars" [value]="car.carID">
          {{ car.make }} {{ car.model }} ({{ car.year }})
        </option>
      </select>
      <small *ngIf="washRequestForm.get('carId')?.touched && washRequestForm.get('carId')?.invalid">Please select a car</small>
    </div>

    <div>
      <label for="washPackageId">Select Package</label>
      <select id="washPackageId" formControlName="washPackageId">
        <option value="" disabled selected>Choose a wash package</option>
        <option *ngFor="let pack of washPackages" [value]="pack.washPackageID">
          {{ pack.packageName }} - ‚Çπ{{ pack.price }}
        </option>
      </select>
      <small *ngIf="washRequestForm.get('washPackageId')?.touched && washRequestForm.get('washPackageId')?.invalid">Please select a package</small>
    </div>

    <div>
      <label>Select Add-ons (Optional)</label>
      <div *ngFor="let addon of addOns" class="addon-option">
        <label>
          <input
            type="checkbox"
            [value]="addon.addOnID"
            (change)="onAddOnChange($event)"
            [checked]="washRequestForm.get('addOnIds')?.value.includes(addon.addOnID)"
          />
          {{ addon.addOnName }} - ‚Çπ{{ addon.price }}
        </label>
      </div>
    </div>

    <div>
      <label for="location">Location</label>
      <input 
        id="location"
        formControlName="location" 
        type="text" 
        placeholder="Your current location" 
        readonly 
      />
      <button type="button" (click)="autoFillLocation()">üìç Auto-Fill Location</button>
      <small *ngIf="washRequestForm.get('location')?.touched && washRequestForm.get('location')?.invalid">Location is required</small>
    </div>

    <button type="submit" [disabled]="washRequestForm.invalid">
      Submit Wash Request
    </button>
  </form>

  <div *ngIf="successMessage" class="success-msg">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="error-msg">{{ errorMessage }}</div>
</div>